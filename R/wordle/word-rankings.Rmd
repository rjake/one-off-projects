---
title: "Wordle Stats"
output: 
  html_document:
    code_folding: show
    df_print: kable
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  warning = FALSE,
  message = FALSE
)
```





raw_words <-
  read_table(file = "~/../Downloads/engmix.txt") |>
  set_names("word") |>
  as.data.frame() # remove attrs


prep_word_list <-
  raw_words |>
  as_tibble() |>
  filter(str_detect(word, "^[a-z]{5}$")) |>
  print()


word_letters <-
  prep_word_list |>
  separate(
    col = word,
    sep = "",
    into = paste0("x", 0:5),
    remove = FALSE
  ) |>
  select(-x0) |>
  print()


word_letters_long <- 
  word_letters |> 
  pivot_longer(
    cols = starts_with("x"),
    names_to = "position",
    values_to = "letter"
  ) |> 
  print()

letter_position_stats <- 
  word_letters_long |> 
  group_by(letter) |> 
  mutate(letter_freq = n()) |> 
  group_by(letter, position) |> 
  mutate(position_freq = n()) |> 
  ungroup() |> 
  print()


word_letter_stats <- 
  word_letters |> 
  left_join(
    letter_position_stats |> 
      select(word, starts_with("position")) |> 
      pivot_wider(
        names_from = position,
        values_from = position_freq,
        names_prefix = "pos_"
      )
  ) |> 
  print()


letter_stats <- 
  letter_position_stats |> 
  distinct(letter, letter_freq, position, position_freq) |> 
  pivot_wider(
    names_from = position,
    values_from = position_freq,
    values_fill = 0
  ) |> 
  arrange(desc(letter_freq)) |> 
  print(n = 15)


word_stats <- 
  letter_position_stats |> 
  mutate(
    letter = factor(letter, levels = letter_stats$letter, ordered = TRUE),
    letter_ord = as.integer(letter)
  ) |> 
  group_by(word) |> 
  arrange(letter) |> 
  summarise(
    n_1_5 = sum(letter %in% letter_stats$letter[1:5]),
    n_6_12 = sum(letter %in% letter_stats$letter[6:12]),
    n_12_26 = sum(letter %in% letter_stats$letter[12:26]),
    letters_rank = paste(letter, collapse = ""),
    letters_alpha = paste(sort(as.character(letter)), collapse = ""),
    n_letter = n_distinct(letter),
    mean_letter_rank = mean(letter_ord),
    mean_letter_freq = mean(letter_freq),
    sum_letter_freq = sum(letter_freq),
    mean_pos_freq = mean(position_freq)
  ) |> 
  ungroup() |> 
  left_join(word_letter_stats) |> 
  arrange(desc(mean_letter_freq)) |> 
  print()


# best starting words: arose, aires, raise, arise, laser, rates
word_stats |> 
  filter(n_letter == 5) |> 
  filter(n_1_5 >= 4) |> 
  #filter(mean_letter == 3) |>
  arrange(mean_letter_rank, desc(mean_pos_freq))

# best 2nd words: unlit until clint tulip multi lucid tunic input
word_stats |> 
  filter(n_letter == 5) |> 
  filter(n_6_12 >= 5) |> 
  arrange(mean_letter_rank, desc(mean_pos_freq))

# best 2nd words: campy psych champ chomp chimp chewy lymph picky
word_stats |> 
  filter(n_letter == 5) |> 
  filter(n_12_26 >= 4) |> 
  arrange(mean_letter_rank, desc(mean_letter_freq))

# last remaining: jumpy gawky whack chivy mucky bumpy glyph
word_stats |> 
  filter(n_letter == 5) |> 
  filter(n_12_26 >= 4) |> 
  filter(!str_detect(word, "[rsnltchmp]")) |> 
  arrange(desc(mean_letter_rank))


# best series: arose - unlit - champ - gawky

# example: floor - has [lor] but not [ais...], [l] is the 2nd letter
str_detect_all <- function(x, letters) {
  pattern <-
    str_split(letters, "")[[1]] |> 
    sort() |> 
    paste(collapse = ".*")

  str_detect(x, pattern)
}


word_stats |> 
  filter(str_detect(word, "m...e")) |> 
  filter(str_detect_all(x = letters_alpha, "yam")) |> 
  # filter(!str_detect(word, "[isemounlinkwvqu]")) |> # none of these letters
  # filter(!str_detect(x1, "[rt]")) |> # none of these positions
  # filter(!str_detect(x2, "[a]")) |>
  # filter(!str_detect(x4, "[r]"))
  print()


write_csv(word_stats, "R/wordle/word-stats.csv")
```
