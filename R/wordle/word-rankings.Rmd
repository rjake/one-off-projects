---
title: "Wordle Stats"
output: 
  html_document:
    code_folding: show
    df_print: kable
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  warning = FALSE,
  message = FALSE
)
```


```{r workspace}
library(tidyverse)

```


```{r}
raw_words <-
  read_csv("input/nyt_word_list.csv") |>
  as_tibble() |>
  print()

word_letters <-
  raw_words |>
  separate(
    col = word,
    sep = "",
    into = paste0("x", 0:5),
    remove = FALSE
  ) |>
  select(-x0) |>
  print()

```

```{r}
word_letters_long <- 
  word_letters |> 
  pivot_longer(
    cols = starts_with("x"),
    names_to = "position",
    values_to = "letter"
  ) |> 
  print()

```

```{r}
letter_position_stats <- 
  word_letters_long |> 
  group_by(letter) |> 
  mutate(letter_freq = n()) |> 
  group_by(letter, position) |> 
  mutate(position_freq = n()) |> 
  ungroup() |> 
  print()

```

```{r}
word_letter_stats <- 
  word_letters |> 
  left_join(
    letter_position_stats |> 
      select(word, starts_with("position")) |> 
      pivot_wider(
        names_from = position,
        values_from = position_freq,
        names_prefix = "pos_"
      )
  ) |> 
  print()

```

Letters by total count and frequency in positions 1:5
```{r letter-stats}
letter_stats <- 
  letter_position_stats |> 
  distinct(letter, letter_freq, position, position_freq) |> 
  pivot_wider(
    names_from = position,
    values_from = position_freq,
    values_fill = 0
  ) |> 
  arrange(desc(letter_freq)) |> 
  print(n = 15)

```

```{r}
word_stats <- 
  letter_position_stats |> 
  mutate(
    letter = factor(letter, levels = letter_stats$letter, ordered = TRUE),
    letter_ord = as.integer(letter)
  ) |> 
  group_by(word) |> 
  arrange(letter) |> 
  summarise(
    n_1_5 = sum(letter %in% letter_stats$letter[1:5]),
    n_6_10 = sum(letter %in% letter_stats$letter[6:12]),
    n_10_15 = sum(letter %in% letter_stats$letter[10:15]),
    n_12_26 = sum(letter %in% letter_stats$letter[12:26]),
    letters_rank = paste(letter, collapse = ""),
    letters_alpha = paste(sort(as.character(letter)), collapse = ""),
    n_letter = n_distinct(letter),
    mean_letter_rank = mean(letter_ord),
    mean_letter_freq = mean(letter_freq),
    sum_letter_freq = sum(letter_freq),
    mean_pos_freq = mean(position_freq)
  ) |> 
  ungroup() |> 
  left_join(word_letter_stats) |> 
  arrange(desc(mean_letter_freq)) |> 
  print()

```

```{r}
distinct_letters <-
  word_stats |> 
  filter(n_letter == 5) |> 
  print()

as_patterns <-
  distinct_letters |>
  # filter(letters_alpha == "aelrt") |> 
  group_by(letters_alpha) |> 
  arrange(desc(mean_pos_freq)) |> 
  summarise(
    words = paste(word, collapse = ","),
    across(starts_with("n_"), mean),
    across(starts_with("mean_letter"), mean)
  ) |> 
  ungroup() |> 
  mutate(
    pattern = str_replace_all(letters_alpha, "(.)(?=.)", "\\1|"),
    .before = everything()
  ) |> 
  arrange(mean_letter_rank) |> 
  print()


# best starting words: later, alter, alert, arose, irate, stare
best_1st <-
  as_patterns |> 
  filter(n_1_5 >= 4) |> 
  print()

# best 2nd words: slice, slain, snail, since, inlay, uncle, scaly, sonic
best_2nd <-
  as_patterns |> 
  filter(n_6_10 >=  4) |> 
  print()

# best 3rd words: duchy, dutch, pouch, punch, pushy, chump, dumpy, pudgy
best_3rd <-
  as_patterns |> 
  filter(n_10_15 >= 4) |> 
  arrange(desc(n_10_15), mean_letter_rank) |> 
  print()

# last remaining: gawky, judge, bawdy, fudge, vodka, debug
best_remaining <-
  as_patterns |> 
  filter(n_12_26 >= 3) |> 
  filter(!str_detect(letters_alpha, "[rtlsncdhp]")) |> 
  arrange(desc(n_12_26)) |> 
  print()







# example: floor - has [lor] but not [ais...], [l] is the 2nd letter
str_detect_all <- function(x, letters) {
  pattern <-
    str_split(letters, "")[[1]] |> 
    sort() |> 
    paste(collapse = ".*")

  str_detect(x, pattern)
}


word_stats |> 
  filter(str_detect(word, "m...e")) |> 
  filter(str_detect_all(x = letters_alpha, "yam")) |> 
  # filter(!str_detect(word, "[isemounlinkwvqu]")) |> # none of these letters
  # filter(!str_detect(x1, "[rt]")) |> # none of these positions
  # filter(!str_detect(x2, "[a]")) |>
  # filter(!str_detect(x4, "[r]"))
  print()
```

```{r outputs, eval=FALSE}
write_csv(word_stats, "R/wordle/output/word-stats.csv")
```
